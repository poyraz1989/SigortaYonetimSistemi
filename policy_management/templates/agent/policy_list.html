{% extends "agent/base_agent.html" %}

{% block title %}PoliÃ§elerim{% endblock %}

{% block content %}
    <h2 class="mb-4">PoliÃ§elerim ({{ policies|length }} Adet)</h2>
    
    <p class="text-end">
		<a href="{% url 'agent_export_policies' %}" class="btn btn-primary me-2">ðŸ“Š CSV Ä°ndir</a>
        <a href="{% url 'agent_policy_add' %}" class="btn btn-success">âž• Yeni PoliÃ§e Ekle</a>
    </p>

    {% if policies %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>PoliÃ§e No</th>
                        <th>Tipi</th>
                        <th>MÃ¼ÅŸteri AdÄ±</th>
                        <th>BaÅŸlangÄ±Ã§ / BitiÅŸ</th>
                        <th>Prim TutarÄ±</th>
                        <th>Durum</th>
                        <th>DÃ¶kÃ¼man</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for policy in policies %}
                        <tr>
                            <td>{{ policy.policy_number }}</td>
                            <td>{{ policy.policy_type }}</td>
                            <td>{{ policy.customer.name }}</td>
                            <td>**{{ policy.start_date|date:"d E Y" }}** / **{{ policy.end_date|date:"d E Y" }}**</td>
                            <td>{{ policy.premium_amount|floatformat:2 }} â‚º</td>
                            <td>
                                <span class="badge 
                                    {% if policy.status == 'active' %}bg-success
                                    {% elif policy.status == 'expired' %}bg-danger
                                    {% else %}bg-secondary
                                    {% endif %}">
                                    {{ policy.get_status_display }}
                                </span>
                            </td>
                       <td>
    {% if policy.document %}
        <div class="d-flex flex-column align-items-start">
            <a href="{{ policy.document.url }}" target="_blank" class="btn btn-sm btn-outline-primary mb-1 w-100">
                <i class="fas fa-download"></i> Ä°ndir
            </a>

            <form action="{% url 'agent_policy_document_delete' pk=policy.pk %}" method="post" class="w-100" onsubmit="return confirm('Bu dÃ¶kÃ¼manÄ± silmek istediÄŸinizden emin misiniz?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger w-100">
                    <i class="fas fa-trash"></i> Sil
                </button>
            </form>
        </div>
    {% else %}
        <span class="text-danger">YÃ¼klenmedi</span>
    {% endif %}
</td>
						<td>
							<a href="{% url 'agent_policy_edit' pk=policy.pk %}" class="btn btn-sm btn-info text-white">DÃ¼zenle</a>
						</td>
							
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-warning" role="alert">
            HenÃ¼z size ait kayÄ±tlÄ± bir poliÃ§e bulunmamaktadÄ±r.
            <a href="{% url 'agent_policy_add' %}" class="alert-link">Hemen Yeni Bir PoliÃ§e Ekleyin.</a>
        </div>
    {% endif %}
{% endblock %}